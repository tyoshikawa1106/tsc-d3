"use strict";function decreasingRandom(t,e,a){var n=d3.random.normal(a,.05);return function(){var a=d3.random.normal(t,e)();return t*=n(),parseFloat(a.toFixed())}}var __extends=this&&this.__extends||function(t,e){function a(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)},Chart;!function(t){var e=function(){function t(t){this.element=t,this.iso8601=d3.time.format("%Y-%m-%d"),this.chartWidth=800}return t}();t.Base=e;var a=function(t){function e(e){t.call(this,e),this.chartHeight=400,this.chartWidth=800,this.legendItemHeight=30,this.legendWidth=150,this.colors=["rgb(0, 113, 188)","rgb(0, 174, 239)","rgb(145, 0, 145)"],this.xAxisHashHeight=10,this.layout="wiggle",this.element=e}return __extends(e,t),e.prototype.render=function(t){var e=this,a=d3.layout.stack().values(function(t){return t.data}).offset(this.layout),n=a(t),r=d3.max(n,function(t){return d3.max(t.data,function(t){return t.y0+t.y})}),i=d3.min(t,function(t){return d3.min(t.data,function(t){return t.x})}),s=d3.time.days(i,new Date),d=this.chartWidth-this.legendWidth,c=d/s.length,l=d3.time.scale().domain([i,d3.time.day(d3.time.day.offset(new Date,1))]).range([0,this.chartWidth-this.legendWidth]),o=d3.scale.linear().domain([0,r]).range([0,this.chartHeight]),h=(l.ticks(d3.time.mondays,1),this.element.append("svg").attr("height",this.chartHeight+25).attr("width",this.chartWidth)),u=h.selectAll("g.bars").data(n).enter().append("g").attr("class","bars").style("fill",function(t,a){return e.colors[a]}).attr("transform","translate("+this.legendWidth+", 0)"),m=h.append("g").attr("class","legend"),p=m.selectAll("g.legendItem").data(n).enter().append("g").attr("class","legendItem").style("fill",function(t,a){return e.colors[a]}).attr("transform",function(t,a){return"translate(0, "+e.legendItemHeight*(2-a)+")"});p.append("rect").attr("width",25).attr("height",25),p.append("text").text(function(t){return t.desc}).attr("x",30).attr("dy","1em");var f=u.selectAll("rect").data(function(t){return t.data}).enter().append("rect").attr("x",function(t,e){return l(t.x)}).attr("y",function(t,a){return e.chartHeight-o(t.y+t.y0)}).attr("width",c).attr("height",function(t,e){return o(t.y)});f.append("title").text(function(t){return e.iso8601(t.x)+" - "+t.y+"ms"});var g=d3.svg.axis();g.scale(l).ticks(d3.time.mondays,1).tickSubdivide(6).tickFormat(this.iso8601).tickSize(10,5,0);h.append("g").attr("class","axis").attr("transform","translate("+this.legendWidth+","+this.chartHeight+")").call(g)},e}(e);t.Bar=a;var n=function(t){function e(e){t.call(this,e),this.labelWidth=140,this.labelGutter=10,this.chartWidth=800,this.element=e}return __extends(e,t),e.prototype.getTextDataString=function(t){return t.pass?"pass":"fail"},e.prototype.render=function(t){var e=this,a=d3.min(t.map(function(t){return d3.time.day(t.data[0].date)})),n=d3.time.days(a,new Date),r=(this.chartWidth-this.labelWidth-this.labelGutter)/n.length,i=d3.time.scale().domain([a,d3.time.day(new Date)]).range([0,r*(n.length-1)]),s=d3.scale.linear().domain([0,1]).range([0,r]),d=this.element.append("svg").attr("height",s(t.length+1)).attr("width",this.chartWidth);d.selectAll("text").data(t).enter().append("text").attr("x",this.labelWidth).attr("transform",function(t,e){return"translate(0,"+s(e)+")"}).attr("dy","1em").attr("text-anchor","end").text(function(t){return t.desc});var c=d.selectAll("g.boxes").data(t).enter().append("g").attr("class","boxes").attr("transform",function(t,e){return"translate(0,"+s(e)+")"}),l=c.selectAll("rect").data(function(t,e){return t.data}).enter().append("rect").attr("class",function(t){return"day "+e.getTextDataString(t)}).attr("x",function(t,a){return e.labelWidth+e.labelGutter+i(t.date)}).attr("width",r).attr("height",r);l.append("title").text(function(t){return e.iso8601(t.date)+" - "+e.getTextDataString(t)});var o=i.ticks(d3.time.mondays,1);return d.append("g").attr("class","dates").selectAll("text").data(o).enter().append("text").text(function(t){return e.iso8601(t)}).attr("transform",function(a,n){return"translate("+(e.labelWidth+e.labelGutter+i(a)+5)+", "+s(t.length+1)+")"}).attr("text-anchor","start"),d.append("g").attr("class","hashes").selectAll("line").data(o).enter().append("line").attr("x1",function(t){return e.labelWidth+e.labelGutter+i(t)}).attr("x2",function(t){return e.labelWidth+e.labelGutter+i(t)}).attr("y1",0).attr("y2",s(t.length+1)),d},e}(e);t.DailyBuild=n}(Chart||(Chart={}));var start=d3.time.day.offset(new Date,-30),end=new Date,days=d3.time.days(start,end),buildData=days.map(function(t){return{date:t,pass:Math.random()>.1}}),compilerTestData=days.map(function(t){return{date:t,pass:Math.random()>.1}}),servicesTestData=days.map(function(t){return{date:t,pass:Math.random()>.1}}),parseRandom=decreasingRandom(400,20,.97),typecheckRandom=decreasingRandom(500,20,.97),emitRandom=decreasingRandom(100,10,.97),parseData=days.map(function(t){return{x:t,y:parseRandom()}}),typecheckData=days.map(function(t){return{x:t,y:typecheckRandom()}}),emitData=days.map(function(t){return{x:t,y:emitRandom()}});document.addEventListener("DOMContentLoaded",function(){var t=new Chart.DailyBuild(d3.select("#passchart"));t.render([{desc:"Build Status",data:buildData},{desc:"Compiler Tests",data:compilerTestData},{desc:"Services Tests",data:servicesTestData}]);var e=[{desc:"Emit",data:emitData},{desc:"Typecheck",data:typecheckData},{desc:"Parse",data:parseData}],a=new Chart.Bar(d3.select("#performanceChart"));a.render(e)});